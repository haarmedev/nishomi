<!-- Title Top Block -->
<div class="titleblk clearfix">
    <h1>Categories</h1>
    <div class="btnBlk">
        <a asp-controller="Category" asp-action="Create" class="btnRed"><i class="mdi mdi-plus-outline"></i>Add New</a>
    </div>
</div>
        <!-- Table List -->
        <div class="datatable">
            <div class="searchBox btntop">
                <input type="text" id="txtSearch" name="" placeholder="Search">
            </div>
            <table id="gridCategoryList">
                <thead class="bgcolor">
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th>Caption</th>
                        <th>Description</th>
                        <th></th>
                    </tr>
                </thead>
            </table>
        </div>
    <div class="clearfix"> </div>

    @section Scripts {
        <script type="text/javascript">
        $(document).ready(function () {
            var dataTable = $('#gridCategoryList').DataTable({
                filter: true,
                paging: true,
                lengthChange: false,
                searching: false,
                ordering: true,
                info: true,
                autoWidth: false,
                processing: true,
                serverSide: true,
                pageLength: 5,
                language: {
                    paginate: {
                        next: '&#8594;', // or '→'
                        previous: '&#8592;' // or '←'
                    },
                    emptyTable: "No data available.."
                },
                columnDefs: [
                    { orderable: false, targets: -1 },
                    { orderable: false, targets: 1 },
                    { orderable: false, targets: 2 },
                    {
                        "defaultContent": "-",
                        "targets": "_all"
                    }
                ],
                columns: [
                    { data: "categoryId", name: "Id", visible: false },
                    { data: "name", name: "name" },
                    { data: "caption", name: "caption" },
                    {data:"description",name:"description"},
                    {
                        defaultContent:
                            '<div class="dropdown"><a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' +
                            ' <i class="fas fa-ellipsis-v"></i>' +
                            '</a>' +
                            '<div class="dropdown-menu" aria-labelledby="dropdownMenuLink">' +
                            '<a class="dropdown-item" id="btnEdit">Edit<i class="mdi mdi-pencil"></i> </a>' +
                            '<a class="dropdown-item" id="btnDelete" >Delete <i class="mdi mdi-delete"></i></a>' +
                            '</div></div>'

                    }
                ],
                ajax: {
                    url: '@Url.Action("GetCategorys", "Category")',
                    type: "POST",
                    datatype: "json",
                    data: function (d) {
                        d.searchText = $('#txtSearch').val();
                    }
                }
            });

             $(document).on("click", "#btnEdit", function () {
             var rowIndex = $('#gridCategoryList tr').index($(this).closest('tr'));
                var entityId = dataTable.cells({ row: (rowIndex - 1), column: 0 }).data()[0];
                var url = '@Url.Action("Edit", "Category", new { id = "entityId" })';
                url = url.replace("entityId", entityId);
                window.location.href = url;
            });

            $(document).on("click", "#btnDelete", function () {
                Swal.fire({
                    title: 'Do you want to delete this?',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.value) {
                         var rowIndex = $('#gridCategoryList tr').index($(this).closest('tr'));
                var entityId = dataTable.cells({ row: (rowIndex - 1), column: 0 }).data()[0];
                var url = '@Url.Action("Delete", "Category", new { id = "entityId" })';
                url = url.replace("entityId", entityId);
                common.genericAjaxCall(url, null, "GET", onAjaxSuccessWithRedirect, onAjaxFailure);
                    }
                });
                return false;
            });

            $('#txtSearch').keyup(function () {
                dataTable.ajax.reload();
            });
        });

        </script>
    }
