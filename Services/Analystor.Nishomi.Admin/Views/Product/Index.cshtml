<!-- Title Top Block -->
<div class="titleblk clearfix">
    <h1>Products</h1>
    <div class="btnBlk">
        <a asp-controller="Product" asp-action="Create" class="btnRed"><i class="mdi mdi-plus-outline"></i>Add New</a>
    </div>
</div>
<!-- Table List -->
<div class="datatable">
    <div class="searchBox btntop">
        <input type="text" id="txtSearch" name="" placeholder="Search">
    </div>
    <table id="gridProductList">
        <thead class="bgcolor">
            <tr>
                <th></th>
                <th>Product Code</th>
                <th>Name</th>
                <th>Caption</th>
                <th>Type</th>
                <th>Color</th>
                <th>Cost</th>
                <th></th>
            </tr>
        </thead>
    </table>
</div>
<div class="clearfix"> </div>
@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            var dataTable = $('#gridProductList').DataTable({
                filter: true,
                paging: true,
                lengthChange: false,
                searching: false,
                ordering: true,
                info: true,
                autoWidth: false,
                processing: true,
                serverSide: true,
                pageLength: 5,
                language: {
                    paginate: {
                        next: '&#8594;', // or '→'
                        previous: '&#8592;' // or '←'
                    },
                    emptyTable: "No data available.."
                },
                columnDefs: [
                    { orderable: false, targets: -1 },
                    { orderable: false, targets: 1 },
                    { orderable: false, targets: 2 },
                    { orderable: false, targets: 3 },
                    { orderable: false, targets: 4 },
                    { orderable: false, targets: 5 },
                    { orderable: false, targets: 6 },
                    {
                        "defaultContent": "-",
                        "targets": "_all"
                    }
                ],
                columns: [
                    { data: "productId", name: "productId", visible: false },
                    { data: "productCode", name: "productCode" },
                    { data: "productName", name: "name" },
                    { data: "caption", name: "caption" },
                    { data: "type", name: "type" },
                    { data: "color", name: "color" },
                    { data: "cost", name: "cost" },
                    {
                        defaultContent:
                            '<div class="dropdown"><a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' +
                            ' <i class="fas fa-ellipsis-v"></i>' +
                            '</a>' +
                            '<div class="dropdown-menu" aria-labelledby="dropdownMenuLink">' +
                            '<a class="dropdown-item" id="btnEdit">Edit<i class="mdi mdi-pencil"></i> </a>' +
                            '<a class="dropdown-item" id="btnDelete" >Delete <i class="mdi mdi-delete"></i></a>' +
                            '</div></div>'

                    }
                ],
                ajax: {
                    url: '@Url.Action("GetProducts", "Product")',
                    type: "POST",
                    datatype: "json",
                    data: function (d) {
                        d.searchText = $('#txtSearch').val();
                    }
                }
            });

             $(document).on("click", "#btnEdit", function () {
             var rowIndex = $('#gridProductList tr').index($(this).closest('tr'));
                var entityId = dataTable.cells({ row: (rowIndex - 1), column: 0 }).data()[0];
                var url = '@Url.Action("Edit", "Product", new { Id = "entityId" })';
                url = url.replace("entityId", entityId);
                window.location.href = url;
            });

            $(document).on("click", "#btnDelete", function () {
                Swal.fire({
                    title: 'Do you want to delete this?',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.value) {
                         var rowIndex = $('#gridProductList tr').index($(this).closest('tr'));
                var entityId = dataTable.cells({ row: (rowIndex - 1), column: 0 }).data()[0];
                var url = '@Url.Action("Delete", "Product", new { Id = "entityId" })';
                url = url.replace("entityId", entityId);
                common.genericAjaxCall(url, null, "GET", onAjaxSuccessWithRedirect, onAjaxFailure);
                    }
                });
                return false;
            });

            $('#txtSearch').keyup(function () {
                dataTable.ajax.reload();
            });
        });

    </script>
}